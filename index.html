<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Critical Path Layers — Aieutics</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Almarai:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --dark: #1a1a1a;
    --bg: #fafafa;
    --card: #ffffff;
    --text: #1a1a1a;
    --grey: #6b6b6b;
    --grey-light: #e5e5e5;
    --grey-muted: #6b6b6b;
    --orange: #FF5F1F;
    --orange-soft: #FFE0D0;
    --orange-hover: #FFF3EC;
    --green-muted: #5a9a6e;
    --blue-muted: #5a8a9e;
    --font-heading: 'Libre Baskerville', 'Lora', Georgia, serif;
    --font-body: 'Almarai', 'Lora', Georgia, serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-body);
    overflow-x: hidden;
    min-height: 100vh;
  }

  /* ── Header ── */
  .header {
    padding: 48px 60px 24px;
    max-width: 1800px;
  }
  .header h1 {
    font-family: var(--font-heading);
    font-weight: 700;
    font-size: 42px;
    letter-spacing: -0.5px;
    line-height: 1.15;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 14px;
  }
  .header h1 .logo {
    height: 1.5em;
    width: auto;
    vertical-align: middle;
    flex-shrink: 0;
  }
  .header h1 span { color: var(--orange); }
  .header .subtitle {
    font-family: var(--font-body);
    font-size: 16px;
    color: var(--grey);
    margin-top: 8px;
    font-style: italic;
  }
  .header .desc {
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--grey-muted);
    margin-top: 16px;
    max-width: 800px;
    line-height: 1.6;
  }
  .header .cta-link {
    display: inline-block;
    margin-top: 14px;
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 700;
    color: var(--orange);
    text-decoration: none;
    letter-spacing: 0.3px;
    transition: color 0.2s;
  }
  .header .cta-link:hover {
    color: var(--text);
  }
  .header .cta-link .arrow {
    display: inline-block;
    margin-left: 6px;
    transition: transform 0.2s;
  }
  .header .cta-link:hover .arrow {
    transform: translateX(4px);
  }

  /* ── Pathway container ── */
  .pathway-wrap {
    padding: 20px 60px 0;
    overflow-x: hidden;
  }
  .pathway {
    display: flex;
    align-items: stretch;
    gap: 8px;
    position: relative;
    width: 100%;
  }

  /* ── Layer card (collapsed default) ── */
  .layer {
    flex: 0 0 60px;
    min-width: 60px;
    position: relative;
    display: flex;
    flex-direction: column;
    cursor: pointer;
    transition: flex 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                min-width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }
  .layer.expanded {
    flex: 1 1 auto;
    min-width: 0;
    cursor: default;
  }

  .layer-inner {
    background: var(--card);
    border-radius: 16px;
    padding: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--grey-light);
    position: relative;
    transition: border-color 0.3s, box-shadow 0.3s, background 0.3s;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    overflow: hidden;
  }

  /* ── Expanded card active indicator ── */
  .layer.expanded .layer-inner {
    background: var(--orange);
    border-color: var(--orange);
    border-top: 3px solid var(--orange);
    box-shadow: 0 4px 24px rgba(255, 95, 31, 0.25);
  }
  .layer.expanded .layer-number {
    color: rgba(255, 255, 255, 0.7);
  }
  .layer.expanded .layer-title {
    color: #ffffff;
  }
  .layer.expanded .layer-mantra {
    color: rgba(255, 255, 255, 0.8);
  }
  .layer.expanded .theme-tag {
    background: rgba(255, 255, 255, 0.18);
    border-color: rgba(255, 255, 255, 0.25);
    color: #ffffff;
  }
  .layer.expanded .theme-tag.cross-cutting {
    background: rgba(255, 255, 255, 0.28);
    border-left-color: #ffffff;
  }
  .layer.expanded .theme-tag.triangle {
    border-left-color: #ffffff;
  }
  .layer.expanded .theme-tag.ordered {
    border-left-color: #ffffff;
  }
  .layer.expanded .theme-note {
    color: rgba(255, 255, 255, 0.7);
  }
  .layer.expanded .gate-section {
    border-top: none;
    background: #f0f0f0;
    margin: 0 -28px -24px;
    padding: 20px 28px 24px;
  }
  .layer.expanded .gate-section-header {
    color: var(--orange);
  }
  .layer.expanded .gate-section-icon {
    border-color: var(--orange);
  }
  .layer.expanded .gate-section-icon svg {
    fill: var(--orange);
  }
  .layer.expanded .gate-section-list li {
    color: var(--grey);
  }
  .layer.expanded .gate-section-list li::before {
    color: var(--orange);
  }

  /* ── Hover on collapsed cards ── */
  .layer:not(.expanded) .layer-inner:hover {
    border-color: var(--orange);
    box-shadow: 0 4px 16px rgba(255, 95, 31, 0.15);
    background: var(--orange-hover);
  }
  .layer:not(.expanded) .layer-inner:hover .collapsed-number,
  .layer:not(.expanded) .layer-inner:hover .collapsed-title {
    color: var(--orange);
  }

  /* ── Collapsed label ── */
  .layer-collapsed-label {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 24px 8px;
    height: 100%;
    text-align: center;
    gap: 16px;
  }
  .layer:not(.expanded) .layer-collapsed-label {
    display: flex;
  }

  .collapsed-number {
    font-family: var(--font-heading);
    font-weight: 400;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--orange);
    writing-mode: vertical-rl;
    text-orientation: mixed;
  }
  .collapsed-title {
    font-family: var(--font-heading);
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
    writing-mode: vertical-rl;
    text-orientation: mixed;
    white-space: nowrap;
  }

  /* ── Expanded content ── */
  .layer-expanded-content {
    display: none;
    flex-direction: column;
    padding: 28px 28px 24px;
  }
  .layer.expanded .layer-expanded-content {
    display: flex;
  }

  .layer-number {
    font-family: var(--font-heading);
    font-weight: 400;
    font-size: 13px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--orange);
    margin-bottom: 4px;
  }
  .layer-title {
    font-family: var(--font-heading);
    font-weight: 700;
    font-size: 22px;
    color: var(--text);
    margin-bottom: 6px;
    line-height: 1.2;
  }
  .layer-mantra {
    font-family: var(--font-body);
    font-size: 13px;
    color: var(--grey-muted);
    font-style: italic;
    margin-bottom: 18px;
    line-height: 1.4;
  }

  /* ── Themes ── */
  .themes {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 20px;
    flex: 1;
  }
  .theme-tag {
    font-family: var(--font-heading);
    font-size: 13px;
    font-weight: 400;
    color: var(--text);
    background: #f5f5f5;
    border: 1px solid var(--grey-light);
    border-radius: 8px;
    padding: 10px 14px;
    line-height: 1.3;
  }
  .theme-tag.cross-cutting {
    border-left: 3px solid var(--orange);
    background: var(--orange-soft);
  }
  .theme-tag.triangle {
    border-left: 3px solid var(--green-muted);
  }
  .theme-tag.ordered {
    border-left: 3px solid var(--blue-muted);
  }
  .theme-tag.conditional {
    opacity: 0.55;
    font-style: italic;
  }
  .theme-note {
    font-size: 11px;
    color: var(--grey-muted);
    font-family: var(--font-body);
    font-style: italic;
    padding: 0 2px;
    margin-top: -2px;
  }

  /* ── Gate section (inside expanded card) ── */
  .gate-section {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 2px dashed var(--orange);
  }
  .gate-section-header {
    font-family: var(--font-heading);
    font-size: 12px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--orange);
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .gate-section-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    border: 2px solid var(--orange);
    border-radius: 50%;
    flex-shrink: 0;
  }
  .gate-section-icon svg {
    width: 12px;
    height: 12px;
    fill: var(--orange);
  }
  .gate-section-list {
    list-style: none;
    padding: 0;
    margin: 0;
    columns: 2;
    column-gap: 24px;
  }
  .gate-section-list li {
    font-family: var(--font-body);
    font-size: 12px;
    color: var(--grey);
    line-height: 1.5;
    padding-left: 16px;
    position: relative;
    margin-bottom: 6px;
    break-inside: avoid;
  }
  .gate-section-list li::before {
    content: '→';
    position: absolute;
    left: 0;
    color: var(--orange);
  }

  /* ── Cross-cutting dynamics section ── */
  .crosscut-section {
    padding: 32px 0 20px;
    width: 100%;
  }
  .crosscut-header {
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--grey-muted);
    margin-bottom: 16px;
  }
  .crosscut-tracks {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .crosscut-track {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .crosscut-label-row {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  .crosscut-name {
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
  }
  .crosscut-bar {
    flex: 1;
    height: 24px;
    position: relative;
    display: flex;
    gap: 4px;
  }
  .crosscut-segment {
    height: 100%;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: flex 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .crosscut-segment-label {
    font-family: var(--font-heading);
    font-size: 9px;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 0 6px;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .crosscut-segment.seg-expanded .crosscut-segment-label {
    opacity: 1;
  }
  .crosscut-desc {
    font-family: var(--font-body);
    font-size: 11px;
    color: var(--grey-muted);
    font-style: italic;
  }

  /* ── Footer ── */
  .footer {
    padding: 32px 60px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1800px;
  }
  .footer-left {
    font-family: var(--font-heading);
    font-size: 12px;
    color: var(--grey-muted);
    letter-spacing: 0.5px;
  }
  .footer-right {
    font-family: var(--font-body);
    font-size: 11px;
    color: var(--grey-muted);
  }
  .footer-right a {
    color: var(--grey-muted);
    text-decoration: none;
  }
  .footer-right a:hover {
    color: #333;
  }

  /* ══════════════════════════════════════
     MOBILE — vertical accordion (<900px)
     ══════════════════════════════════════ */
  @media (max-width: 900px) {

    /* Header */
    .header {
      padding: 28px 20px 16px;
    }
    .header h1 {
      font-size: 26px;
      gap: 10px;
    }
    .header h1 .logo {
      height: 1em;
    }
    .header .subtitle {
      font-size: 14px;
      margin-top: 6px;
    }
    .header .desc {
      font-size: 13px;
      margin-top: 12px;
    }

    /* Pathway — vertical stack */
    .pathway-wrap {
      padding: 16px 20px 0;
    }
    .pathway {
      flex-direction: column;
      gap: 6px;
    }

    /* Layer cards — all full width */
    .layer {
      flex: none;
      min-width: 100%;
      width: 100%;
      cursor: pointer;
      transition: none;
      overflow: visible;
    }
    .layer.expanded {
      min-width: 100%;
    }

    .layer-inner {
      border-radius: 12px;
      overflow: visible;
    }

    /* Collapsed label — horizontal bar */
    .layer:not(.expanded) .layer-collapsed-label {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: flex-start;
      padding: 16px 20px;
      height: auto;
      min-height: 54px;
      gap: 12px;
    }
    .collapsed-number {
      writing-mode: horizontal-tb;
      text-orientation: initial;
      font-size: 11px;
    }
    .collapsed-title {
      writing-mode: horizontal-tb;
      text-orientation: initial;
      font-size: 15px;
    }

    /* Expanded content */
    .layer-expanded-content {
      padding: 20px 20px 18px;
    }
    .layer-title {
      font-size: 19px;
    }

    /* Gate section — single column on mobile */
    .gate-section-list {
      columns: 1;
    }

    /* Cross-cutting — simplified vertical stack */
    .crosscut-section {
      padding: 24px 0 16px;
    }
    .crosscut-track {
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
    }
    .crosscut-name {
      min-width: auto;
      font-size: 12px;
    }
    .crosscut-bar {
      width: 100%;
      height: 20px;
    }
    .crosscut-segment-label {
      font-size: 8px;
    }
    .crosscut-desc {
      font-size: 10px;
    }

    /* Footer */
    .footer {
      padding: 24px 20px 32px;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
    }
    .footer-left {
      font-size: 11px;
    }
    .footer-right {
      font-size: 10px;
    }
  }

</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <h1><a href="https://aieutics.com" target="_blank"><img class="logo" src="aieutics_transparentbg_logo.svg" alt="Aieutics"></a>Critical Path <span>Layers</span></h1>
  <div class="subtitle">Startups and Scaleup Innovation Edition</div>
  <div class="desc">Themes are ordered by when they must be resolved, not what domain they belong to. Each layer gates the next. Working on downstream themes before upstream prerequisites are resolved is the most common pattern of wasted founder effort.</div>
  <a class="cta-link" href="https://aieutics.com/framework" target="_blank">Read more about the framework <span class="arrow">→</span></a>
</div>


<!-- Main Pathway -->
<div class="pathway-wrap">
  <div class="pathway">

    <!-- Layer 0 -->
    <div class="layer expanded" data-layer="0">
      <div class="layer-inner">
        <div class="layer-collapsed-label">
          <span class="collapsed-number">L0</span>
          <span class="collapsed-title">Foundations</span>
        </div>
        <div class="layer-expanded-content">
          <div class="layer-number">Layer 0</div>
          <div class="layer-title">Foundations</div>
          <div class="layer-mantra">Must be true before anything else works</div>
          <div class="themes">
            <div class="theme-tag">Strategy</div>
            <div class="theme-tag">Product</div>
            <div class="theme-tag cross-cutting">Founder Bottleneck ⟳</div>
            <div class="theme-note">Cross-cutting: surfaces here first, recurs at every layer</div>
          </div>
          <div class="gate-section">
            <div class="gate-section-header">
              <span class="gate-section-icon">
                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
              </span>
              Gate 0 → 1
            </div>
            <ul class="gate-section-list">
              <li>Problem in buyer language</li>
              <li>Basic problem-solution fit</li>
              <li>Strategic thesis testable</li>
              <li>Founder constraints visible</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Layer 1 -->
    <div class="layer" data-layer="1">
      <div class="layer-inner">
        <div class="layer-collapsed-label">
          <span class="collapsed-number">L1</span>
          <span class="collapsed-title">Market Clarity</span>
        </div>
        <div class="layer-expanded-content">
          <div class="layer-number">Layer 1</div>
          <div class="layer-title">Market Clarity</div>
          <div class="layer-mantra">The ICP–Value Prop–Price triangle</div>
          <div class="themes">
            <div class="theme-tag triangle">Go-to-Market</div>
            <div class="theme-tag triangle">Competitive Positioning</div>
            <div class="theme-tag triangle">Pricing</div>
            <div class="theme-note">△ Triangle: these three resolve together, not sequentially</div>
          </div>
          <div class="gate-section">
            <div class="gate-section-header">
              <span class="gate-section-icon">
                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
              </span>
              Gate 1 → 2
            </div>
            <ul class="gate-section-list">
              <li>ICP specific enough to name accounts</li>
              <li>Value prop in one buyer sentence</li>
              <li>Willingness-to-pay evidence</li>
              <li>Positioning vs. buyer alternatives</li>
              <li>Pricing fits buyer budget model</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Layer 2 -->
    <div class="layer" data-layer="2">
      <div class="layer-inner">
        <div class="layer-collapsed-label">
          <span class="collapsed-number">L2</span>
          <span class="collapsed-title">Validation</span>
        </div>
        <div class="layer-expanded-content">
          <div class="layer-number">Layer 2</div>
          <div class="layer-title">Validation</div>
          <div class="layer-mantra">Prove it in a real corporate context</div>
          <div class="themes">
            <div class="theme-tag ordered">Corporate Engagement</div>
            <div class="theme-tag ordered">Technology Integration</div>
            <div class="theme-tag ordered">POC / Pilot</div>
            <div class="theme-note">↓ Ordered: engagement intel → tech feasibility → pilot execution</div>
          </div>
          <div class="gate-section">
            <div class="gate-section-header">
              <span class="gate-section-icon">
                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
              </span>
              Gate 2 → 3
            </div>
            <ul class="gate-section-list">
              <li>Pilot completed with success criteria</li>
              <li>Results packaged for champion</li>
              <li>Tech integration proven</li>
              <li>Pilot-to-contract path mapped</li>
              <li>Governance understood</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Layer 3 -->
    <div class="layer" data-layer="3">
      <div class="layer-inner">
        <div class="layer-collapsed-label">
          <span class="collapsed-number">L3</span>
          <span class="collapsed-title">Commercial Engine</span>
        </div>
        <div class="layer-expanded-content">
          <div class="layer-number">Layer 3</div>
          <div class="layer-title">Commercial Engine</div>
          <div class="layer-mantra">Build repeatable demand — only after validation</div>
          <div class="themes">
            <div class="theme-tag">Sales</div>
            <div class="theme-tag">Marketing / Visibility</div>
            <div class="theme-tag">Brand / Creative Direction</div>
          </div>
          <div class="gate-section">
            <div class="gate-section-header">
              <span class="gate-section-icon">
                <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
              </span>
              Gate 3 → 4
            </div>
            <ul class="gate-section-list">
              <li>Repeatable sales process</li>
              <li>Sales motion documented</li>
              <li>Marketing tied to pipeline</li>
              <li>Brand consistent and credible</li>
              <li>Revenue growing, economics plausible</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Layer 4 -->
    <div class="layer" data-layer="4">
      <div class="layer-inner">
        <div class="layer-collapsed-label">
          <span class="collapsed-number">L4</span>
          <span class="collapsed-title">Scale Readiness</span>
        </div>
        <div class="layer-expanded-content">
          <div class="layer-number">Layer 4</div>
          <div class="layer-title">Scale Readiness</div>
          <div class="layer-mantra">Systematise what works, not what you hope will work</div>
          <div class="themes">
            <div class="theme-tag">Operations / Process</div>
            <div class="theme-tag">Team / Leadership</div>
            <div class="theme-tag">Scaling</div>
            <div class="theme-tag">Financial Management</div>
            <div class="theme-tag conditional">Fundraising (conditional)</div>
          </div>
        </div>
      </div>
    </div>

  </div>

<!-- Cross-Cutting Dynamics -->
<div class="crosscut-section">
  <div class="crosscut-header">Cross-Cutting Dynamics</div>
  <div class="crosscut-tracks">
    <div class="crosscut-track" data-track="founder">
      <div class="crosscut-label-row">
        <div class="crosscut-name" style="color: var(--orange);">Founder Bottleneck</div>
        <div class="crosscut-desc">Recursive — different manifestation at each layer</div>
      </div>
      <div class="crosscut-bar" id="bar-founder"></div>
    </div>
    <div class="crosscut-track" data-track="corporate">
      <div class="crosscut-label-row">
        <div class="crosscut-name">Corporate Engagement</div>
        <div class="crosscut-desc">Pervasive in accelerator contexts, peaks at Layer 2</div>
      </div>
      <div class="crosscut-bar" id="bar-corporate"></div>
    </div>
    <div class="crosscut-track" data-track="strategy">
      <div class="crosscut-label-row">
        <div class="crosscut-name">Strategy</div>
        <div class="crosscut-desc">Foundational at Layer 0, strategic decisions recur throughout</div>
      </div>
      <div class="crosscut-bar" id="bar-strategy"></div>
    </div>
  </div>
</div>
</div>

<!-- Footer -->
<div class="footer">
  <div class="footer-left">AIEUTICS — Critical Path Layers for startups v1.2 · February 2026</div>
  <div class="footer-right">Built by <a href="https://www.aieutics.com">Aieutics</a>. These tools are starting points. If your results raise questions, <a href="https://www.aieutics.com">let's talk</a>.</div>
</div>

<script>
(function() {
  'use strict';

  var layers = document.querySelectorAll('.layer');
  var pathway = document.querySelector('.pathway');

  /* ── Intensity data per layer (0-1) for each cross-cutting dynamic ── */
  var trackData = {
    founder: {
      intensities: [0.5, 0.4, 0.5, 0.7, 0.9],
      labels: ['Delegation', '', '', 'Sales handoff', 'Leadership team']
    },
    corporate: {
      intensities: [0.12, 0.15, 1.0, 0.35, 0.12],
      labels: ['', '', 'Most decisive', '', '']
    },
    strategy: {
      intensities: [1.0, 0.2, 0.2, 0.2, 0.2],
      labels: ['Foundation', '', 'Recurrent decisions', '', '']
    }
  };

  /* ── Build segment elements once ── */
  function buildSegments() {
    Object.keys(trackData).forEach(function(key) {
      var bar = document.getElementById('bar-' + key);
      bar.innerHTML = '';
      var track = trackData[key];
      for (var i = 0; i < 5; i++) {
        var seg = document.createElement('div');
        seg.className = 'crosscut-segment';
        seg.dataset.layer = i;
        var alpha = Math.max(track.intensities[i], 0.08);
        seg.style.background = 'rgba(255,95,31,' + alpha + ')';
        if (track.labels[i]) {
          var lbl = document.createElement('span');
          lbl.className = 'crosscut-segment-label';
          lbl.textContent = track.labels[i];
          seg.appendChild(lbl);
        }
        bar.appendChild(seg);
      }
    });
  }

  /* ── Sync segment widths to match card positions ── */
  function syncBars() {
    var pathwayRect = pathway.getBoundingClientRect();
    var totalWidth = pathwayRect.width;
    if (totalWidth <= 0) return;

    var layerArr = Array.prototype.slice.call(layers);
    var widths = layerArr.map(function(l) {
      return l.getBoundingClientRect().width;
    });

    var bars = document.querySelectorAll('.crosscut-bar');
    bars.forEach(function(bar) {
      var segments = bar.querySelectorAll('.crosscut-segment');
      segments.forEach(function(seg, i) {
        var pct = (widths[i] / totalWidth) * 100;
        seg.style.flex = '0 0 ' + pct + '%';
        if (layerArr[i].classList.contains('expanded')) {
          seg.classList.add('seg-expanded');
        } else {
          seg.classList.remove('seg-expanded');
        }
      });
    });
  }

  /* ── Expand/collapse ── */
  function expandLayer(target) {
    layers.forEach(function(layer) {
      layer.classList.remove('expanded');
    });
    target.classList.add('expanded');
    /* Sync bars after transition starts, and again after it ends */
    requestAnimationFrame(syncBars);
    setTimeout(syncBars, 520);
  }

  layers.forEach(function(layer) {
    layer.addEventListener('click', function() {
      if (!this.classList.contains('expanded')) {
        expandLayer(this);
      }
    });
  });

  /* ── Init ── */
  buildSegments();
  /* Wait for layout to settle before first sync */
  requestAnimationFrame(function() {
    requestAnimationFrame(syncBars);
  });
  window.addEventListener('resize', syncBars);
})();
</script>

</body>
</html>
